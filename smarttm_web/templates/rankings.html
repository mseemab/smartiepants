<!DOCTYPE html>
<html lang="en">

  <head>
	<title>Participation Rankings</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
		{% include "includes.html" %}
		<script>
			$(document).ready( function () {
				$('#table_id').DataTable();
				$('#table_id1').DataTable();
			} );
		</script>
		
	</head>
	<body>
		<div class="container-fluid" style="padding:0;" >
			{% include "nav.html" %}
		</div>
		<div class="container-fluid">
			<h3>Participation Rankings {{ PageName }}</h3>
		
		</div>
		<!-- <br /><br /> -->
		<div class="container-fluid" >

			<hr />	
			<br><br>
			<div class = "row">
				<div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="padding-top: 6px" >
					<b>Date Range</b>
				</div>
				
					<form action="" method="POST">
							{% csrf_token %}
							<div class="col-lg-3 col-md-3 col-sm-3 col-xs-4">
								<input type="hidden" name="ToolID" id="ToolID" value="3" />
								<input type="date" name="StartDate" id="StartDate" placeholder="From Date" class="form-control" required />
							</div>
							
							<div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
								<input type="date" name="EndDate" id="EndDate" placeholder="To Date" class="form-control"  required />
							</div>
							
							<div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
								<button class="btn btn-primary" type="Submit" ><i class="fas fa-filter"></i> Filter</button>
								<button class="btn btn-primary" data-toggle="modal" data-target="#myModal">Update Data</button>
							</div>
					</form>
					 
			<br>
			<br>
			<br>
			<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" >
						
						{% if FromDate != '' %}
							<h4>Time Period: <span class='badge label-primary'>{{ FromDate }}</span> to <span class='badge label-primary'>{{ ToDate }}</span></h4>
						{% else %}
							
						{% endif %}
						<br>
			</div>
			<div class="row">
				  
				<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" >
					<div class="table-wrapper">
						<div class="table-title">
							<table  class="table table-bordered" >
							<thead>
								<tr>
									<th>Rank</th>
									<th>Name</th>
									<th>Table Topics Participation</th>
									<th>Speeches Participation</th>
									<th>Evaluations</th>
									<th>Basic Leadership roles</th>
									<th>Advanced Leadership roles</th>
								</tr>
							</thead>
							<tbody>
								{% for summ_Obj in summ_set %}
									<tr>
										<td>{{ forloop.counter }}</td>
										<td>{{ summ_Obj.member.user.full_name }}</td>
										<td>{{ summ_Obj.tt_count }}</td>
										<td>{{ summ_Obj.speeches_count }}</td>
										<td>{{ summ_Obj.evaluation_count }}</td>
										<td><a href="#" onClick="GetHistory({{ summ_Obj.member.pk }}, 'basic');">{{ summ_Obj.basic_role_count }}</a></td>
										<td><a href="#" onClick="GetHistory({{ summ_Obj.member.pk }}, 'advanced');">{{ summ_Obj.adv_role_count }}</a></td>
									</tr>
								{% endfor %}
							</tbody>
							</table>
						</div>
					</div>
				</div>
				
			</div>
		</div>
		
		
		
		<!-- Modal -->
		
		<div class="modal fade" id="RoleDetail" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		  <div class="modal-dialog" role="document">
			<div class="modal-content">
			  <div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalLabel">Roles Performed</h4>
			  </div>
			  <div class="modal-body">
				<div class="row">
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" >
						<div class="table-wrapper">
							<div class="table-title">
								
							</div>
							
							<div id="divpost"></div>
						</div>
					</div>
					
					
				</div>
			  </div>
			  <div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

			  </div>
			</div>
		  </div>
		</div>
		
		<!-- Modal -->
		
		<script>
			
			function GetHistory(MemberID, ParticipationType){
				console.log(MemberID)
				 
				 
				$.get( "/api/getcatparticipations/"+MemberID+"/"+ParticipationType+"/",
				function( data ) {
				 
				  console.log(data)
				  createTableByForLoop(data)
				  $("#RoleDetail").modal();
//					$('#overlay').hide() 
				});
			}
		
			function createTableByForLoop(data)
			{
			  var eTable="<table class='table table-striped small'><thead><tr><th>Name</th><th>Category</th><th>Dated</th</tr></thead><tbody>"
			  
			  for(var i=0; i<data.length;i++)
			  {
				
				eTable += "<tr>";
				eTable += "<td>"+data[i]['participation_type']['name']+"</td>";
				eTable += "<td>"+data[i]['participation_type']['category']+"</td>";
				eTable += "<td>"+data[i]['meeting']['meeting_date']+"</td>";
			 
				eTable += "</tr>";
			  }
			  eTable +="</tbody></table>";
			  $('#divpost').html(eTable);
			}
		</script>
		
	</body>
</html>